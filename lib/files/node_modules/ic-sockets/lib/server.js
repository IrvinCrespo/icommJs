var colors = require("colors")
const redis = require('socket.io-redis');
var redis_host = process.env.REDIS_HOST;
var redis_port = process.env.REDIS_PORT;

var sock;

function config(hProtocol){
    var protocol = hProtocol;
    sock = require('socket.io')(protocol, {
        allowUpgrades: true,
        transports: ['websocket', 'flashsocket', 'polling'],
        'log level': 1,
        'pingInterval': 2000,
        'pingTimeout': 5000
    });
    sock.adapter(redis({ host: redis_host, port: redis_port }))
    console.log(colors.yellow("Corriendo servidor de sockets! - pid -> "+process.pid));
    //console.log("PRIMIS: ",sock)
    return sock
}

module.exports = {
    config:config,
    IO:()=>sock
}

/*module.exports = {
    config:((hProtocol) => {
        var protocol = hProtocol;
        new Promise((resolve,reject)=>{
            
        });
        io = require('socket.io')(protocol, {
            allowUpgrades: true,
            transports: ['websocket', 'flashsocket', 'polling'],
            'log level': 1,
            'pingInterval': 80000,
            'pingTimeout': 25000
        });
        console.log(colors.yellow("Corriendo servidor de sockets! - pid -> "+process.pid));
        
        console.log("PRIMIS: ",io)
        return io
    })
}*/
