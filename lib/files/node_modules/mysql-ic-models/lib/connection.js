var mysql = require('mysql');
var pool;
var host = process.env.DB_HOST;
var port = process.env.DB_PORT;
var db = process.env.DB_NAME;
var user = process.env.DB_USER;
var pass = process.env.DB_PASS;

function connection(callback){
	if (pool) {
		pool.getConnection(function(err,conn){
			callback(err,conn);
		});
	}else{
		pool = mysql.createPool({
			host     : host,
			port     : port,
			user     : user,
			password : pass,
			database : db,
			charset	 : "utf8mb4",
			multipleStatements: true
      	});
		
      	pool.getConnection(function(err,conn){
      		callback(err,conn);
		});
	}
}


module.exports = {
    getConnection: function () {
      if (pool) return pool;
      pool = mysql.createPool({
        host     : 'localhost',
		user     : 'root',
		password : 'password',
		database : 'sportpi2_wargame',
		charset	 : "utf8mb4",
		multipleStatements: true
      });
      return pool;
    },
    connection:connection
};